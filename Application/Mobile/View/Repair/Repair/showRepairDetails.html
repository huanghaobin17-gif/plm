<include file="Public:head"/>
<title>维修进程详情</title>
<style>
    .companyHideDetail,.approvesHideDetail{
        display: none;
    }
    .layui-table tr th{width: 24%;}
    .red{color: #FF5722}
    .green{color: #85AB70}
    .assetsHideDetail{display: none;}
    .layui-card-body{padding: 0}
    .moreButton{text-align: center;height: 2rem;line-height: 2rem;}
    .moreButton a{color: #2a7ae2;}
    .layui-timeline{padding-left: 3rem;width: 80%;}
    .timelineContentDiv{overflow: hidden;margin-top: 0.5rem;}
    .layui-timeline-title span{font-size: 1rem;margin-right: 1rem;}
    .layui-timeline-item:before{left: 0.1875rem;width: 3px;}
    .newTips{width: 2rem;height: 1.125rem;border: 1px solid #ebebeb;border-radius: 4px;position: absolute;color: #fff;font-size: 12px;display: inline-block;top: -1px;left: -2.875rem;background-color: #0af;line-height: 18px;text-align: center;  }
    .newTips:before{box-sizing: content-box;width: 0;height: 0;position: absolute;top: 4px;left: 2.03rem;padding: 0;border-bottom: 5px solid transparent;border-top: 5px solid transparent;border-left: 10px solid #0af;border-right: 4px solid transparent;display: block;content: "";z-index: 12;}
    .layui-timeline-item:before{display: none;!important;}/*先屏蔽layui自带时间线*/
    .layui-timeline-item:first-child:before{display: none;!important;}/*先屏蔽layui自带时间线*/
    .line{background-color: #9e9e9e;position: absolute;left: 0.2812rem;width: 1px;z-index: 6666;top: 1rem;}
    .layui-timeline-title{margin-bottom: 0;font-weight: normal;}
    .layui-card-body .layui-table{margin: 0;}
    .partsTable .layui-table tbody tr:first-child td{text-align: center;}
    .partsTable .layui-table tr td{width: auto;}
    .partsTable .layui-table tbody tr td{text-align: left;}

    .suggestIconDiv{
        position: absolute;
        right: 1rem;
        top: -0.5rem;
    }
    .suggestIcon{
        width: 2.5rem;
    }
    #media,#showImages{
        color:#76ABDF;
    }
    .gray{
        color: #666;
        margin-left: 10px;
    }
    .layui-timeline-axis{margin-top:0;left: -6px;}
</style>
<body>
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-header borderNone">
            <h2 class="detailTitle">维修单详情</h2>
            <div class="bl1px"></div>
        </div>
        <div class="layui-card-body">
            <table class="layui-table" lay-even>
                <tbody>
                <tr>
                    <th>维修单号</th>
                    <td>{$repArr.repnum}</td>
                </tr>
                <tr>
                    <th>报修科室</th>
                    <td>{$asArr.department}</td>
                </tr>
                <tr>
                    <th>设备编号</th>
                    <td>{$asArr.assnum}</td>
                </tr>
                <tr>
                    <th>设备原编号</th>
                    <td>{$asArr.assorignum}</td>
                </tr>
                <tr>
                    <th>设备名称</th>
                    <td>{$asArr.assets}</td>
                </tr>
                <tr class="assetsHideDetail">
                    <th>规格/型号</th>
                    <td>{$asArr.model}</td>
                </tr>
                <tr class="assetsHideDetail">
                    <th>报修人</th>
                    <td>{$repArr.applicant}</td>
                </tr>
                <tr class="assetsHideDetail">
                    <th>报修时间</th>
                    <td>{$repArr.applicant_time}</td>
                </tr>
                <tr class="assetsHideDetail">
                    <th>接单时间</th>
                    <td>{$repArr.response_date}</td>
                </tr>
	            <tr class="assetsHideDetail">
                    <th>接单备注</th>
                    <td>{$repArr.reponse_remark}</td>
                </tr>
                <tr class="assetsHideDetail">
                    <th>签到时间</th>
                    <td>{$repArr.sign_in_time}</td>
                </tr>
                <tr class="assetsHideDetail">
                    <th>维修工程师</th>
                    <td>{$repArr.response}</td>
                </tr>
                <tr class="assetsHideDetail">
                    <th>故障问题</th>
                    <td><?php echo htmlspecialchars_decode($repArr['fault_problem']) ?></td>
                </tr>
                <tr class="assetsHideDetail">
                    <th>故障描述</th>
                    <td>{$repArr.breakdown}</td>
                </tr>
                <tr class="assetsHideDetail">
                    <th>语音描述</th>
                    <td>
                        <if condition="$repArr['wxTapeAmr']">
                            <i class="layui-icon layui-icon-voice"><audio src="{$repArr.wxTapeAmr}" id="audio"></audio><span class="voiceTime">{$repArr.seconds}〞</span></i>
                            <span id="media">点击播放</span>
                            <else/>
                            无
                        </if>
                    </td>
                </tr>
                <tr class="assetsHideDetail">
                    <th>故障照片</th>
                    <td>
                        <empty name="repArr['pic_url']">
                            无
                            <else/>
                            <a class="green" id="showImages">查看(共{$repArr.imgCount}张)</a>
                        </empty>
                    </td>
                </tr>
                <tr class="assetsHideDetail">
                    <th>检修备注</th>
                    <td>{$repArr.repair_remark}</td>
                </tr>
                <tr class="assetsHideDetail">
                    <th>维修性质</th>
                    <td>{$repArr.repTypeName}</td>
                </tr>
                <tr class="assetsHideDetail">
                    <th>处理详情</th>
                    <td>{$repArr.dispose_detail}</td>
                </tr>
                </tbody>
            </table>
            <div class="layui-card" style="margin-top: 0;">
                <div class="moreButton">
                    <a class="moreDetailButton" data-detailClass="assetsHideDetail">加载更多</a>
                </div>
                <div class="moreButton" style="display: none;">
                    <a class="hideDetailButton" data-detailClass="assetsHideDetail">收起</a>
                </div>
            </div>
        </div>
    </div>
    <!--保修厂家-->
    <if condition="$repArr['repair_type'] EQ C('REPAIR_TYPE_IS_GUARANTEE_NAME')">
    <div class="layui-card assetsHideDetail">
        <div class="layui-card-header borderNone">
            <h2 class="detailTitle">保修信息</h2>
            <div class="bl1px"></div>
        </div>
        <div class="layui-card-body">
            <table class="layui-table">
                <tbody>
                <tr>
                    <th>维修厂家</th>
                    <td>{$repArr.repair}</td>
                </tr>
                <tr>
                    <th>维修公司联系人</th>
                    <td>{$repArr.repa_user}</td>
                </tr>
                <tr>
                    <th>维修公司联系电话</th>
                    <td>{$repArr.repa_tel}</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    </if>

    <!--第三方-->
    <notempty name="company">
        <div class="layui-card companyDiv">
            <div class="layui-card-header borderNone">
                <h2 class="detailTitle">报价信息</h2>
                <div class="bl1px"></div>
            </div>
            <volist name="company" id="v">
                <?php if($v['last_decisioin']!=C('YES_STATUS')){ ?>
                <?php $companyDivClass='companyHideDetail'; ?>
                <?php }else{ ?>
                <?php $companyDivClass=''; ?>
                <?php }   ?>
                <div class="layui-card-body {$companyDivClass}">
                    <if condition="$v['last_decisioin'] EQ C('YES_STATUS')">
                        <div class="suggestIconDiv">
                            <img class="suggestIcon" src="__PUBLIC__/mobile/images/icon/suggest.png">
                        </div>
                    </if>
                    <table class="layui-table">
                        <tbody>
                        <tr>
                            <th>公司名称</th>
                            <td>{$v.offer_company}</td>
                        </tr>
                        <tr>
                            <th>公司资质</th>
                            <td>{$v.aptitude}</td>
                        </tr>
                        <tr>
                            <th>联系人</th>
                            <td>{$v.offer_contacts}</td>
                        </tr>
                        <tr>
                            <th>联系人电话</th>
                            <td>{$v.telphone}</td>
                        </tr>
                        <tr>
                            <th>维修周期</th>
                            <td>{$v.cycle}</td>
                        </tr>
                        <tr>
                            <th>发票</th>
                            <td>{$v.invoice}</td>
                        </tr>
                        <tr>
                            <th>费用</th>
                            <td>{$v.total_price}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </volist>
        </div>
        <?php if(count($company)>1){ ?>
        <div class="layui-card" style="margin-top: 0;">
            <div class="moreButton">
                <a class="moreDetailButton" data-detailClass="companyHideDetail">加载更多</a>
            </div>
            <div class="moreButton" style="display: none;">
                <a class="hideDetailButton" data-detailClass="companyHideDetail">收起</a>
            </div>
        </div>
        <?php } ?>
    </notempty>

    <!--配件-->
    <notempty name="parts">
        <div class="layui-card partsTable">
        <div class="layui-card-header borderNone">
            <h2 class="detailTitle">配件信息</h2>
            <div class="bl1px"></div>
        </div>
        <div class="layui-card-body">
            <table class="layui-table" lay-even>
                <tbody>
                <tr>
                    <td>配件名称</td>
                    <td>规格型号</td>
                    <td>数量</td>
                </tr>
                <volist name="parts" id="v">
                    <tr>
                        <td class="content_center">{$v.parts}</td>
                        <td class="content_center">{$v.part_model}</td>
                        <td class="content_center">{$v.part_num}</td>
                    </tr>
                </volist>
                </tbody>
            </table>
        </div>
    </div>
    </notempty>

    <!--审批-->
    <notempty name="approves">
        <div class="layui-card">
            <div class="layui-card-header borderNone">
                <h2 class="detailTitle">审批信息</h2>
                <div class="bl1px"></div>
            </div>
            <div class="layui-card-body">
                <table class="layui-table" lay-even>
                    <tbody>
                    <volist name="approves" id="app">
                        <?php if($i!=1){?>
                        <?php $approvesDivClass='approvesHideDetail'; ?>
                        <?php }else{ ?>
                        <?php $approvesDivClass=''; ?>
                        <?php }   ?>
                        <tr class="{$approvesDivClass}">
                            <th>审批人</th>
                            <td>{$app.approver}</td>
                        </tr>
                        <tr class="{$approvesDivClass}">
                            <th>审批时间</th>
                            <td>{$app.approve_time}</td>
                        </tr>
                        <tr class="{$approvesDivClass}">
                            <th>审批意见</th>
                            <if condition="$app['is_adopt'] EQ C('HAVE_STATUS')">
                                <td><i class="layui-icon layui-icon-zzcheck" style="color: #5FB878"></i></td>
                                <else/>
                                <td><i class="layui-icon layui-icon-zzclose" style="color: red"></i></td>
                            </if>
                        </tr>
                        <tr class="{$approvesDivClass}">
                            <th>备注</th>
                            <td>{$app.remark}</td>
                        </tr>
                    </volist>
                    </tbody>
                </table>
            </div>
            <?php if(count($approves)>1){ ?>
            <div class="layui-card" style="margin-top: 0;">
                <div class="moreButton">
                    <a class="moreDetailButton" data-detailClass="approvesHideDetail">加载更多</a>
                </div>
                <div class="moreButton" style="display: none;">
                    <a class="hideDetailButton" data-detailClass="approvesHideDetail">收起</a>
                </div>
            </div>
            <?php } ?>
        </div>
    </notempty>


    <div class="layui-card">
        <div class="layui-card-header borderNone">
            <h2 class="detailTitle">设备维修进程</h2>
            <div class="bl1px"></div>
        </div>
        <div class="layui-card-body mgt1rem">
            <ul class="layui-timeline">
                <volist name="repairTimeLine" id="v">
                    <li class="layui-timeline-item">
                        <div class="line"></div>
                        <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
                        <div class="layui-timeline-content layui-text">
                            <h3 class="layui-timeline-title">{$v.statusName} {$v.date}</h3>
                            <div class="timelineContentDiv">
                                {$v.user}({$v.telephone}) {$v.text}
                            </div>
                        </div>
                    </li>
                </volist>
            </ul>
        </div>
    </div>
</div>
</body>
<include file="Public:buttom"/>

<script src="__PUBLIC__/mobile/js/weui/showImages.js"></script>
<script>
    <notempty name="repArr['pic_url']">
    var pic_url = {$repArr.pic_url};
    var photos = $.photoBrowser({
        items: pic_url
    });
    </notempty>

    $("#showImages").click(function(){
        photos.open();
    });

    layui.use('element', function(){
        var element = layui.element;

        //初始化下方导航栏菜单
        menuListSpread();


        /*时间线预处理*/
        var timeLineObj = $(".layui-timeline-item");
        timeLineObj.each(function(k,v){
            var thisLine = $(v).children('.line');
            thisLine.css('height',$(v).height()+5);
            thisLine.css('background-color','9e9e9ef5');
        });
        $(".gray").click(function () {
            var result = [];
            $(this).parent().find(".imageUrl").each(function (k, v) {
                result.push($(v).val());
            });

            var thisPhotos = $.photoBrowser({items: result});
            thisPhotos.open();
        });
        /**/
    });
    $(".layui-timeline-content").first().append('<span class="newTips">最新</span>');
    $(".newTips").siblings('.layui-timeline-title').css('color','#0af');
</script>
<script>
    //播放停止语音
    var audio = document.getElementById("audio");
    if(audio){
        var btn = document.getElementById("media");
        btn.onclick = function () {
            if (audio.paused) { //判断当前的状态是否为暂停，若是则点击播放，否则暂停
                audio.play();
            }else{
                audio.pause();
            }
        };
    }
</script>
