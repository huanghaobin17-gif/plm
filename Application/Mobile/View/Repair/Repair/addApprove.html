<include file="Public:head"/>
<title>维修审批</title>
<style>
    .assetsHideDetail,.companyHideDetail,.approvesHideDetail{display: none;}

    .partsTable .layui-table tr td {
        width: auto;
        text-align: center;
    }

    .partsTable .layui-table thead tr th {
        width: auto;
        text-align: center;
    }

    .layui-table tr th{width: 24%;}
    .red{color: #FF5722}
    .green{color: #85AB70}
    .assetsHideDetail{display: none;}
    .layui-card-body{padding: 0}
    .formDiv{margin-top: 1.25rem;}
    .emptyDiv{display: none;margin-bottom: 1.25rem;position: relative;z-index: 10;}
    .emptyDiv .layui-card-body{padding: 10px 15px;}
    .formDiv .layui-card-body{padding: 10px 15px;}
    .moreButton{text-align: center;height: 2rem;line-height: 2rem;}
    .moreButton a{color: #2a7ae2;}
    .layui-timeline-title span{font-size: 1rem;margin-right: 1rem;}
    .layui-card-body .layui-table{margin: 0;}



    .followTable thead tr th{text-align: center;}
    .addFollowDiv{
        z-index: 100000;
    }
    .addFollowDiv{
        z-index: 100000;
    }
    .addFollowDiv .weui-popup__modal .weui-icon-cancel {
        position: absolute;
        right: 0.2rem;
        top: 0.8rem;
        color: #888;
        font-size: 1.5rem;
        cursor: pointer;
    }
    .addFollowDiv .weui-popup__modal{
        background-color: #fff;
    }
    .weui-picker-overlay, .weui-picker-container{
        z-index: 100001;
    }
    .companyDiv .layui-card-body{
        margin-top: 1.25rem;
    }
    .companyDiv .layui-card-body:nth-child(odd) .layui-table tr{
        background-color: #e6e6e654;
    }
    .suggestIconDiv{
        position: absolute;
        right: 1rem;
        top: -0.5rem;
    }
    .suggestIcon{
        width: 2.5rem;
    }
    #media,#showImages{
        color:#76ABDF;
    }
    .gray{
        color: #666;
        margin-left: 10px;
    }
</style>
<body>
<div class="layui-fluid setForm">
    <form class="layui-form">
        <div class="emptyDiv"></div>
        <div class="layui-card moveAnimatedDiv" style="margin-top: 0;">
            <div class="layui-card-header borderNone">
                <h2 class="detailTitle">维修单详情</h2>
                <div class="bl1px"></div>
            </div>
            <div class="layui-card-body">
                <table class="layui-table" lay-even>
                    <tbody>
                    <tr>
                        <th>维修单号</th>
                        <td>{$repArr.repnum}</td>
                    </tr>
                    <tr>
                        <th>报修科室</th>
                        <td>{$asArr.department}</td>
                    </tr>
                    <tr>
                        <th>设备编号</th>
                        <td>{$asArr.assnum}</td>
                    </tr>
                    <tr>
                        <th>设备名称</th>
                        <td>{$asArr.assets}</td>
                    </tr>
                    <tr class="assetsHideDetail">
                        <th>规格/型号</th>
                        <td>{$asArr.model}</td>
                    </tr>
                    <tr class="assetsHideDetail">
                        <th>报修人</th>
                        <td>{$repArr.applicant}</td>
                    </tr>
                    <tr class="assetsHideDetail">
                        <th>报修时间</th>
                        <td>{$repArr.applicant_time}</td>
                    </tr>
                    <tr class="assetsHideDetail">
                        <th>接单时间</th>
                        <td>{$repArr.response_date}</td>
                    </tr>
                    <tr class="assetsHideDetail">
                        <th>维修工程师</th>
                        <td>{$repArr.response}</td>
                    </tr>
                    <tr class="assetsHideDetail">
                        <th>故障问题</th>
                        <td><?php echo htmlspecialchars_decode($repArr['fault_problem']) ?></td>
                    </tr>
                    <tr class="assetsHideDetail">
                        <th>故障描述</th>
                        <td>{$repArr.breakdown}</td>
                    </tr>
                    <tr class="assetsHideDetail">
                        <th>语音描述</th>
                        <td>
                            <if condition="$repArr['wxTapeAmr']">
                                <i class="layui-icon layui-icon-voice"><audio src="{$repArr.wxTapeAmr}" id="audio"></audio><span class="voiceTime">{$repArr.seconds}〞</span></i>
                                <span id="media">点击播放</span>
                                <else/>
                                无
                            </if>
                        </td>
                    </tr>
                    <tr class="assetsHideDetail">
                        <th>故障照片</th>
                        <td>
                            <empty name="repArr['pic_url']">
                                无
                                <else/>
                                <a class="green" id="showImages">查看(共{$repArr.imgCount}张)</a>
                            </empty>
                        </td>
                    </tr>
                    <tr class="assetsHideDetail">
                        <th>检修备注</th>
                        <td>{$repArr.repair_remark}</td>
                    </tr>
                    <tr class="assetsHideDetail">
                        <th>维修性质</th>
                        <td>{$repArr.repTypeName}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="layui-card" style="margin-top: 0;">
                <div class="moreButton">
                    <a class="moreDetailButton" data-detailClass="assetsHideDetail">加载更多</a>
                </div>
                <div class="moreButton" style="display: none;">
                    <a class="hideDetailButton" data-detailClass="assetsHideDetail">收起</a>
                </div>
            </div>
        </div>
        <!--保修厂家-->
        <if condition="$repArr['repair_type'] EQ C('REPAIR_TYPE_IS_GUARANTEE_NAME')">
            <div class="layui-card">
                <div class="layui-card-header borderNone">
                    <h2 class="detailTitle">保修信息</h2>
                    <div class="bl1px"></div>
                </div>
                <div class="layui-card-body">
                    <table class="layui-table">
                        <tbody>
                        <tr>
                            <th>维修厂家</th>
                            <td>{$repArr.repair}</td>
                        </tr>
                        <tr>
                            <th>维修公司联系人</th>
                            <td>{$repArr.repa_user}</td>
                        </tr>
                        <tr>
                            <th>维修公司联系电话</th>
                            <td>{$repArr.repa_tel}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </if>
        <!--第三方-->
        <notempty name="company">
            <div class="layui-card companyDiv">
                <div class="layui-card-header borderNone">
                    <h2 class="detailTitle">报价信息</h2>
                    <div class="bl1px"></div>
                </div>
                <volist name="company" id="v">
                    <?php if($v['last_decisioin']!=C('YES_STATUS')){ ?>
                    <?php $companyDivClass='companyHideDetail'; ?>
                    <?php }else{ ?>
                    <?php $companyDivClass=''; ?>
                    <?php }   ?>
                    <div class="layui-card-body {$companyDivClass}">
                        <if condition="$v['last_decisioin'] EQ C('YES_STATUS')">
                            <div class="suggestIconDiv">
                                <img class="suggestIcon" src="__PUBLIC__/mobile/images/icon/suggest.png">
                            </div>
                        </if>
                        <table class="layui-table">
                            <tbody>
                            <tr>
                                <th>公司名称</th>
                                <td>{$v.offer_company}</td>
                            </tr>
                            <tr>
                                <th>公司资质</th>
                                <td>
                                    {$v.aptitude}
                                </td>
                            </tr>
                            <tr>
                                <th>联系人</th>
                                <td>{$v.offer_contacts}</td>
                            </tr>
                            <tr>
                                <th>联系人电话</th>
                                <td>{$v.telphone}</td>
                            </tr>
                            <tr>
                                <th>维修周期</th>
                                <td>{$v.cycle}</td>
                            </tr>
                            <tr>
                                <th>发票</th>
                                <td>{$v.invoice}</td>
                            </tr>
                            <tr>
                                <th>费用</th>
                                <td>{$v.total_price}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </volist>
            </div>
            <?php if(count($company)>1){ ?>
            <div class="layui-card" style="margin-top: 0;">
                <div class="moreButton">
                    <a class="moreDetailButton" data-detailClass="companyHideDetail">加载更多</a>
                </div>
                <div class="moreButton" style="display: none;">
                    <a class="hideDetailButton" data-detailClass="companyHideDetail">收起</a>
                </div>
            </div>
            <?php } ?>
        </notempty>


        <notempty name="parts">
        <div class="layui-card partsTable">
            <div class="layui-card-header borderNone">
                <h2 class="detailTitle">配件信息</h2>
                <div class="bl1px"></div>
            </div>
            <div class="layui-card-body" style="padding: 10px 15px;">
                <div class="partsTable">
                    <table class="layui-table" lay-even>
                        <thead>
                        <tr>
                            <th>配件名称</th>
                            <th>规格型号</th>
                            <th>数量</th>
                            <th>总价</th>
                        </tr>
                        </thead>
                        <tbody>
                        <notempty name="parts">
                            <volist name="parts" id="v">
                                <tr class="not_check">
                                    <td>{$v.parts}</td>
                                    <td>{$v.part_model}</td>
                                    <td>{$v.part_num}</td>
                                    <td>{$v.price_sum}</td>
                                </tr>
                            </volist>
                            <else/>
                            <tr class="emptyParts">
                                <td colspan="4" style="text-align: center;">暂无配件</td>
                            </tr>
                        </notempty>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        </notempty>

        <!--审批流程-->
        <notempty name="repArr.app_user_status">
        <div class="layui-card partsTable" style="min-height: 120px;height: 175px;">
            <div class="layui-card-header borderNone">
                <h2 class="detailTitle">审批流程&进度</h2>
                <div class="bl1px"></div>
            </div>
            <div class="layui-card-body" style="padding: 10px 15px;">
                {$repArr.app_user_status}
            </div>
        </div>
        </notempty>
        <!--审批-->
        <notempty name="approves">
            <div class="layui-card">
                <div class="layui-card-header borderNone">
                    <h2 class="detailTitle">审批信息</h2>
                    <div class="bl1px"></div>
                </div>
                <div class="layui-card-body">
                    <table class="layui-table" lay-even>
                        <tbody>
                        <volist name="approves" id="app">
                            <?php if($i!=1){?>
                            <?php $approvesDivClass='approvesHideDetail'; ?>
                            <?php }else{ ?>
                            <?php $approvesDivClass=''; ?>
                            <?php }   ?>
                            <tr class="{$approvesDivClass}">
                                <th>审批人</th>
                                <td>{$app.approver}</td>
                            </tr>
                            <tr class="{$approvesDivClass}">
                                <th>审批时间</th>
                                <td>{$app.approve_time}</td>
                            </tr>
                            <tr class="{$approvesDivClass}">
                                <th>审批意见</th>
                                <if condition="$app['is_adopt'] EQ C('HAVE_STATUS')">
                                    <td><i class="layui-icon layui-icon-zzcheck" style="color: #5FB878"></i></td>
                                    <else/>
                                    <td><i class="layui-icon layui-icon-zzclose" style="color: red"></i></td>
                                </if>
                            </tr>
                            <tr class="{$approvesDivClass}">
                                <th>备注</th>
                                <td>
                                    <if condition="$app.remark neq ''">
                                        {$app.remark}
                                        <else/>
                                        暂无备注
                                    </if>
                                </td>
                            </tr>
                        </volist>
                        </tbody>
                    </table>
                </div>
                <?php if(count($approves)>1){ ?>
                <div class="layui-card" style="margin-top: 0;">
                    <div class="moreButton">
                        <a class="moreDetailButton" data-detailClass="approvesHideDetail">加载更多</a>
                    </div>
                    <div class="moreButton" style="display: none;">
                        <a class="hideDetailButton" data-detailClass="approvesHideDetail">收起</a>
                    </div>
                </div>
                <?php } ?>
            </div>
        </notempty>
        <if condition="$is_display eq 1">
            <div class="formDiv">
                <div class="layui-card mgt0">
                    <input type="hidden" name="repid" value="{$repArr.repid}"/>
                    <div class="layui-card-header">
                        <img class="formImage" src="__PUBLIC__/mobile/images/icon/form.png">
                        <h2 class="formTitle">审批表单</h2>
                        <a class="upFormButton">表单置顶<i class="layui-icon layui-icon-zarrow-up-l"></i></a>
                        <a class="downFormButton">表单置底<i class="layui-icon layui-icon-zarrow-down-l"></i></a>
                    </div>
                    <div class="layui-card-body">
                        <div class="layui-form-item mgb1rem">
                            <label class="layui-form-label">审批意见：</label>
                            <div class="layui-input-block">
                                <input type="radio" name="is_adopt" value="1" title="通过" checked="checked">
                                <input type="radio" name="is_adopt" value="2" title="不通过">
                            </div>
                        </div>
                        <div class="layui-form-item mgb1rem">
                            <label class="layui-form-label">备注：</label>
                            <div class="layui-input-block">
                                <input type="text" name="approveRemark" placeholder="请输入审批备注" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item mgb1rem">
                            <label class="layui-form-label">审批人：</label>
                            <div style="line-height: 38px;">{$approveUser}</div>
                        </div>

                        <div class="layui-form-item mgb1rem">
                            <label class="layui-form-label">审批时间：</label>
                            <div style="line-height: 38px;">{$approveDate}</div>
                        </div>
                        <div class="layui-form-item mgt1rem">
                            <button class="layui-btn" style="width: 100%;" lay-submit lay-filter="submit">确认并提交</button>
                        </div>
                    </div>
                </div>
            </div>
        </if>
    </form>
</div>
</body>
<include file="Public:buttom"/>
<script src="__PUBLIC__/mobile/js/weui/showImages.js"></script>
<script src="__PUBLIC__/mobile/js/ajax.js"></script>
<script>
    var addApproveUrl='{$addApproveUrl}';
    <notempty name = "repArr['pic_url']">
        var pic_url = {$repArr.pic_url};
        var photos = $.photoBrowser({items: pic_url});
        $("#showImages").click(function(){
            photos.open();
        });
    </notempty >
</script>
<script src="__PUBLIC__/mobile/js/repair/repair/addApprove.js?v={:mt_rand(1,54561)}"></script>