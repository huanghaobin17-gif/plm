<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>质控明细录入</title>
    <include file="Public:layerHeader"/>
    <style>
        th{ text-align: right!important; font-weight: bold!important;}
        .no-padding-td{ padding: 0px!important;}
        .no-padding-td .layui-input {
            border: none;
            height: 40px;
            line-height: 40px;
        }
        #scanfile{
            display: none;
        }
        .local-upload{
            float: left;
            font-size: 12px;
            font-weight: normal;
            color: #0a8ddf;
            cursor: pointer;
            margin-right: 10px;
        }
       .paizhao{
            float: left;
            font-size: 12px;
            font-weight: normal;
            color: #0a8ddf;
            cursor: pointer;
            vertical-align:middle;
            margin-right: 10px;
            height: 30px;
            line-height: 30px;
        }
        .read-table th{
            width: 12%;
        }
        .qrcode {
            display: none;
            width: 218px;
            height: 255px;
            padding: 20px 14px;
            box-sizing: border-box;
            position: absolute;
            background: url('/Public/images/qrcode.png') no-repeat;
            background-size:188px 220px;
            right:75px;
            top: 25px;
            z-index: 30;
        }
        .qrcode img{
            width: 85%;
            max-width: 85% !important;
        }
        .qrcode .tip {
            width: 170px;
            text-align: center;
            vertical-align: top;
            display: block;
            font-size: 14px;
            color: #333;
        }
        .local-upload{
            margin-top: 4px;
        }
        .ulli li{
            height: 25px;
            line-height: 25px;
            float: left;
            padding: 0 5px 0 12px;
            margin-right: 10px;
            margin-bottom: 5px;
            border: 1px solid #E3E3E4;
        }
        .remove_pic{
            cursor: pointer;
        }
        .remove_pic:hover{
            color:red;
        }
        .pic_name{
            color: #00a6c8;
            cursor: pointer;
        }
        .red_border {
            border: 1px solid #CC0000 !important;
        }
    </style>
    <script>
        var assets = "{$asInfo.assets}";
        var assid = "{$asInfo.assid}";
        var assnum = "{$asInfo.assnum}";
    </script>
</head>
<body>
    <div class="containDiv">
    <blockquote class="layui-elem-quote">
        质控计划详情信息
    </blockquote>
    <table class="layui-table" lay-size="sm" lay-even="" style=" margin-top: 0px!important;">
        <colgroup>
            <col width="150">
            <col>
            <col width="200">
            <col>
        </colgroup>
        <tbody>
        <tr>
            <th>检测报告编号:</th>
            <td>{$qsInfo.plan_num}</td>
            <th>质控计划名称：</th>
            <td>{$qsInfo.plan_name}</td>
        </tr>
        <tr>
            <th>检测依据：</th>
            <td>{$qsInfo.basis}</td>
            <th>检测仪器（标准器、模拟器）：</th>
            <td>{$qsInfo.instrument}</td>
        </tr>
        </tbody>
    </table>
    <blockquote class="layui-elem-quote">
        检测设备基础信息
    </blockquote>
    <table class="layui-table" lay-even="" lay-size="sm" style=" margin-top: 0px!important;">
        <colgroup>
            <col width="150">
            <col>
            <col width="150">
            <col>
        </colgroup>
        <tbody>
        <tr>
            <th>设备名称：</th>
            <td>{$asInfo.assets}</td>
            <th>设备编号：</th>
            <td>{$asInfo.assnum}</td>
        </tr>
        <tr>
            <th>使用科室：</th>
            <td>{$asInfo.department}</td>
            <th>产品序列号：</th>
            <td>{$asInfo.serialnum}</td>
        </tr>
        <tr>
            <th>品牌：</th>
            <td>{$asInfo.brand}</td>
            <th>规格 / 型号：</th>
            <td>{$asInfo.model}</td>
        </tr>
        <tr>
            <th>启用日期：</th>
            <td>{$asInfo.opendate}</td>
            <th>上次质控时间：</th>
            <td>{$asInfo.lasttesttime}</td>
        </tr>
        </tbody>
    </table>
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend>质控检测明细表单(质控模板：{$templatename})</legend>
    </fieldset>
    <form action="" class="layui-form">
        <input type="hidden" name="qsid" value="{$qsInfo.qsid}"/>
        <input type="hidden" name="report" value=""/>
        <if condition="$detail_data">
            <input type="hidden" name="save_edit" value="edit"/>
        </if>
        <table class="layui-table" lay-size="sm" >
            <colgroup>
                <col width="147">
                <col width="200">
                <col width="150">
                <col>
            </colgroup>
            <tbody>
            <tr>
                <th>外观功能：</th>
                <td>
                    <div class="layui-inline">
                        <input type="radio" name="lookslike" value="1" lay-skin="primary" title="符合" <if condition="$detail_data['exterior'] eq 1">checked</if> />
                        <input type="radio" name="lookslike" value="2" lay-skin="primary" title="不符合"<if condition="$detail_data['exterior'] eq 2">checked</if> />
                    </div>
                </td>
                <th>不符合情况说明：</th>
                <td class="no-padding-td">
                    <input type="text" name="lookslike_desc" value="{$detail_data['exterior_explain']}" placeholder="请输入说明情况" autocomplete="off" class="layui-input">
                </td>
            </tr>
            </tbody>
        </table>

        <table class="layui-table" lay-size="sm">
            <colgroup>
                <col width="146">
                <col width="130">
                <col width="220">
                <col width="220">
                <col width="">
            </colgroup>
            <tbody>
            <tr>
                <th rowspan="2">
                    流量检测：
                    <volist name="values" id="vo">
                        <if condition="$vo.detection_name eq '流量检测'">
                            <br><span style="font-weight:normal!important;">最大允差：{$vo.tolerance}</span>
                        </if>
                    </volist>
                </th>
                <th>流量测试点：</th>
                <volist name="values" id="vo">
                    <if condition="$vo.detection_name eq '流量检测'">
                        <volist name="vo.set" id="ho" offset="0" length='2'>
                            <td>{$ho}</td>
                        </volist>
                        <?php $length = count($vo['set']);?>
                    </if>
                </volist>
                <?php for($i = 0;$i<(2-$length);$i++){ ?>
                <td></td>
                <?php } ?>
                <th style="text-align: center!important;">检测结果</th>
            </tr>
            <tr>
                <th>平均流量：</th>
                <volist name="values" id="vo">
                    <if condition="$vo.detection_name eq '流量检测'">
                        <volist name="vo.set" id="ho" offset="0" length='2'>
                            <td class="no-padding-td">
                                <input type="text" name="flow[]" value="{$detail_data['preset_detection']['flow'][$key]}" placeholder="请输入测量值" autocomplete="off" class="layui-input">
                            </td>
                        </volist>
                        <?php $length = count($vo['set']);?>
                    </if>
                </volist>
                <?php for($i = 0;$i<(2-$length);$i++){ ?>
                <td class="no-padding-td"></td>
                <?php } ?>
                <td>
                    <div class="layui-inline">
                        <input type="radio" disabled name="flow_result" value="1" lay-skin="primary" title="符合" <if condition="$detail_data['preset_detection']['flow_result'] eq 1">checked</if> />
                        <input type="radio" disabled name="flow_result" value="2" lay-skin="primary" title="不符合" <if condition="$detail_data['preset_detection']['flow_result'] eq 2">checked</if> />
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
        <table class="layui-table" lay-size="sm">
            <colgroup>
                <col width="147">
                <col width="130">
                <col width="220">
                <col width="220">
                <col width="">
            </colgroup>
            <tbody>
            <tr>
                <th rowspan="2">
                    阻塞报警检测：
                    <volist name="values" id="vo">
                        <if condition="$vo.detection_name eq '阻塞报警检测'">
                            <br><span style="font-weight:normal!important;">最大允差：{$vo.tolerance}</span>
                        </if>
                    </volist>
                </th>
                <th>阻塞报警设置值：</th>
                <volist name="values" id="vo">
                    <if condition="$vo.detection_name eq '阻塞报警检测'">
                        <volist name="vo.set" id="ho" offset="0" length='2'>
                            <td>{$ho}</td>
                        </volist>
                        <?php $length = count($vo['set']);?>
                    </if>
                </volist>
                <?php for($i = 0;$i<(2-$length);$i++){ ?>
                <td></td>
                <?php } ?>
                <th style="text-align: center!important;">检测结果</th>
            </tr>
            <tr>
                <td></td>
                <volist name="values" id="vo">
                    <if condition="$vo.detection_name eq '阻塞报警检测'">
                        <volist name="vo.set" id="ho" offset="0" length='2'>
                            <td class="no-padding-td">
                                <input type="text" name="block[]" value="{$detail_data['preset_detection']['block'][$key]}" placeholder="请输入测量值" autocomplete="off" class="layui-input">
                            </td>
                        </volist>
                        <?php $length = count($vo['set']);?>
                    </if>
                </volist>
                <?php for($i = 0;$i<(2-$length);$i++){ ?>
                <td class="no-padding-td"></td>
                <?php } ?>
                <td>
                    <div class="layui-inline">
                        <input type="radio" disabled name="block_result" value="1" lay-skin="primary" title="符合" <if condition="$detail_data['preset_detection']['block_result'] eq 1">checked</if> />
                        <input type="radio" disabled name="block_result" value="2" lay-skin="primary" title="不符合" <if condition="$detail_data['preset_detection']['block_result'] eq 2">checked</if> />
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
        <table class="layui-table" lay-size="sm">
            <colgroup>
                <col width="146">
                <col width="130">
                <col>
                <col width="130">
                <col>
            </colgroup>
            <tbody>
            <tr>
                <th rowspan="4">报警系统检测</th>
                <th>堵塞</th>
                <td>
                    <div class="layui-inline">
                        <input type="radio" name="blocking" value="1" lay-skin="primary" title="符合" <if condition="$detail_data['fixed_detection']['blocking'] eq 1">checked</if> />
                        <input type="radio" name="blocking" value="2" lay-skin="primary" title="不符合" <if condition="$detail_data['fixed_detection']['blocking'] eq 2">checked</if> />
                        <input type="radio" name="blocking" value="3" lay-skin="primary" title="不适用" <if condition="$detail_data['fixed_detection']['blocking'] eq 3">checked</if> />
                    </div>
                </td>
                <th>即将空瓶</th>
                <td>
                    <div class="layui-inline">
                        <input type="radio" name="forthcoming_empty_bottle" value="1" lay-skin="primary" title="符合" <if condition="$detail_data['fixed_detection']['forthcoming_empty_bottle'] eq 1">checked</if> />
                        <input type="radio" name="forthcoming_empty_bottle" value="2" lay-skin="primary" title="不符合" <if condition="$detail_data['fixed_detection']['forthcoming_empty_bottle'] eq 2">checked</if> />
                        <input type="radio" name="forthcoming_empty_bottle" value="3" lay-skin="primary" title="不适用" <if condition="$detail_data['fixed_detection']['forthcoming_empty_bottle'] eq 3">checked</if> />
                    </div>
                </td>
            </tr>
            <tr>
                <th>电池电量不足</th>
                <td>
                    <div class="layui-inline">
                        <input type="radio" name="battery_low" value="1" lay-skin="primary" title="符合" <if condition="$detail_data['fixed_detection']['battery_low'] eq 1">checked</if> />
                        <input type="radio" name="battery_low" value="2" lay-skin="primary" title="不符合" <if condition="$detail_data['fixed_detection']['battery_low'] eq 2">checked</if> />
                        <input type="radio" name="battery_low" value="3" lay-skin="primary" title="不适用" <if condition="$detail_data['fixed_detection']['battery_low'] eq 3">checked</if> />
                    </div>
                </td>
                <th>流速错误</th>
                <td>
                    <div class="layui-inline">
                        <input type="radio" name="flow_error" value="1" lay-skin="primary" title="符合" <if condition="$detail_data['fixed_detection']['flow_error'] eq 1">checked</if> />
                        <input type="radio" name="flow_error" value="2" lay-skin="primary" title="不符合" <if condition="$detail_data['fixed_detection']['flow_error'] eq 2">checked</if> />
                        <input type="radio" name="flow_error" value="3" lay-skin="primary" title="不适用" <if condition="$detail_data['fixed_detection']['flow_error'] eq 3">checked</if> />
                    </div>
                </td>
            </tr>
            <tr>
                <th>输液管路安装不妥</th>
                <td>
                    <div class="layui-inline">
                        <input type="radio" name="improper_installation" value="1" lay-skin="primary" title="符合" <if condition="$detail_data['fixed_detection']['improper_installation'] eq 1">checked</if> />
                        <input type="radio" name="improper_installation" value="2" lay-skin="primary" title="不符合" <if condition="$detail_data['fixed_detection']['improper_installation'] eq 2">checked</if> />
                        <input type="radio" name="improper_installation" value="3" lay-skin="primary" title="不适用" <if condition="$detail_data['fixed_detection']['improper_installation'] eq 3">checked</if> />
                    </div>
                </td>
                <th>气泡报警</th>
                <td>
                    <div class="layui-inline">
                        <input type="radio" name="bubble_alarm" value="1" lay-skin="primary" title="符合" <if condition="$detail_data['fixed_detection']['bubble_alarm'] eq 1">checked</if> />
                        <input type="radio" name="bubble_alarm" value="2" lay-skin="primary" title="不符合" <if condition="$detail_data['fixed_detection']['bubble_alarm'] eq 2">checked</if> />
                        <input type="radio" name="bubble_alarm" value="3" lay-skin="primary" title="不适用" <if condition="$detail_data['fixed_detection']['bubble_alarm'] eq 3">checked</if> />
                    </div>
                </td>
            </tr>
            <tr>
                <th>电源线脱开</th>
                <td>
                    <div class="layui-inline">
                        <input type="radio" name="power_line_disconnect" value="1" lay-skin="primary" title="符合" <if condition="$detail_data['fixed_detection']['power_line_disconnect'] eq 1">checked</if> />
                        <input type="radio" name="power_line_disconnect" value="2" lay-skin="primary" title="不符合" <if condition="$detail_data['fixed_detection']['power_line_disconnect'] eq 2">checked</if> />
                        <input type="radio" name="power_line_disconnect" value="3" lay-skin="primary" title="不适用" <if condition="$detail_data['fixed_detection']['power_line_disconnect'] eq 3">checked</if> />
                    </div>
                </td>
                <th>开门报警</th>
                <td>
                    <div class="layui-inline">
                        <input type="radio" name="open_door_alarm" value="1" lay-skin="primary" title="符合" <if condition="$detail_data['fixed_detection']['open_door_alarm'] eq 1">checked</if> />
                        <input type="radio" name="open_door_alarm" value="2" lay-skin="primary" title="不符合" <if condition="$detail_data['fixed_detection']['open_door_alarm'] eq 2">checked</if> />
                        <input type="radio" name="open_door_alarm" value="3" lay-skin="primary" title="不适用" <if condition="$detail_data['fixed_detection']['open_door_alarm'] eq 3">checked</if> />
                    </div>
                </td>
            </tr>
            </tbody>
        </table>

        <table class="layui-table" lay-size="sm">
            <colgroup>
                <col width="147">
                <col width="180">
                <col>
            </colgroup>
            <tbody>
                <tr>
                    <th>设备铭牌照片</th>
                    <td>
                        <span class="paizhao">
                            <i class="layui-icon layui-icon-zqrcode-l" style="font-size: 13px;"></i>
                            扫码上传
                            <div class="qrcode">
                                <img src="{$codeUrl['nameplate']}" alt="扫码上传">
                                <span class="tip">扫一扫，上传照片</span>
                            </div>
                        </span>
                        <span class="local-upload nameplate"><i class="iconfont icon-shangchuan" style="font-size: 14px;"></i> 本地上传</span>
                    </td>
                    <td id="nameplate">
                        <ul class="ulli">
                            <volist name="file_data['nameplate']" id="vo">
                                <li><span class="pic_name" data-url="{$vo.file_url}">{$vo.file_name}</span> &nbsp;&nbsp;<i class="layui-icon layui-tab-close remove_pic" data-id="{$vo.file_id}">&#x1006;</i></li>
                            </volist>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <th>检测仪器视图照片</th>
                    <td>
                        <span class="paizhao">
                            <i class="layui-icon layui-icon-zqrcode-l" style="font-size: 13px;"></i>
                            扫码上传
                            <div class="qrcode">
                                <img src="{$codeUrl['instrument_view']}" alt="扫码上传">
                                <span class="tip">扫一扫，上传照片</span>
                            </div>
                        </span>
                        <span class="local-upload instrument_view"><i class="iconfont icon-shangchuan" style="font-size: 14px;"></i> 本地上传</span>
                    </td>
                    <td id="instrument_view">
                        <ul class="ulli">
                            <volist name="file_data['instrument_view']" id="vo">
                                <li><span class="pic_name" data-url="{$vo.file_url}">{$vo.file_name}</span> &nbsp;&nbsp;<i class="layui-icon layui-tab-close remove_pic" data-id="{$vo.file_id}">&#x1006;</i></li>
                            </volist>
                        </ul>
                    </td>
                </tr>
            </tbody>
        </table>

        <table class="layui-table" lay-size="sm">
            <colgroup>
                <col width="147">
                <col>
            </colgroup>
            <tbody>
            <tr>
                <th>评分：</th>
                <td>
                    <div class="layui-inline">
                        <input type="radio" disabled name="fen" value="1" lay-skin="primary" title="1分">、
                        <input type="radio" disabled name="fen" value="2" lay-skin="primary" title="2分">、
                        <input type="radio" disabled name="fen" value="3" lay-skin="primary" title="3分">、
                        <input type="radio" disabled name="fen" value="4" lay-skin="primary" title="4分">、
                        <input type="radio" disabled name="fen" value="5" lay-skin="primary" title="5分">
                    </div>
                </td>
            </tr>
            <tr>
                <th>检测结果：</th>
                <td>
                    <div class="layui-inline">
                        <input type="radio" disabled name="total_result" value="1" lay-skin="primary" title="合格" <if condition="$detail_data['result'] eq 1">checked</if> />
                        <input type="radio" disabled name="total_result" value="2" lay-skin="primary" title="不合格" <if condition="$detail_data['result'] eq 2">checked</if> />
                    </div>
                </td>
            </tr>
            <tr>
                <th>备注：<br/>（偏离情况说明）</th>
                <td class="no-padding-td">
                    <input type="text" name="total_desc" value="{$detail_data['remark']}" placeholder="请输入备注" autocomplete="off" class="layui-input">
                </td>
            </tr>
            </tbody>
        </table>
        <br/>
        <br/> 
        <div class="layui-form-item" style="text-align: center; margin-bottom: 50px;">
            <button type="button" class="layui-btn layui-btn-primary" id="scanfile" data-url="">
                预览报告
            </button>
            <button class="layui-btn layui-btn-warm" lay-submit lay-filter="upload" id="file_url" name="file_url" lay-tips="设备的质控测量值及检测结果，以签字的纸质报告为准！请务必上传文件报告！">
                <i class="layui-icon">&#xe67c;</i>上传纸质报告
            </button>
            <button class="layui-btn" lay-submit lay-filter="keepquality" style="background: #F7B824"><i class="layui-icon">&#xe609;</i> 保存质控记录
            </button>
                <button class="layui-btn" lay-submit lay-filter="save" lay-tips="设备的质控测量值及检测结果，以签字的纸质报告为准！请务必上传文件报告！">
                    <i class="layui-icon" >&#xe609;</i>确认并提交
                </button>
            <button type="reset" class="layui-btn layui-btn-primary">
                <i class="layui-icon">ဂ</i> 重置
            </button>
        </div>
    </form>
</div>
</body>
</html>
<script>
    var qsid = "{$qsInfo.qsid}";
    layui.use('controller/qualities/quality/setQualityDetail', layui.factory('controller/qualities/quality/setQualityDetail'));
</script>